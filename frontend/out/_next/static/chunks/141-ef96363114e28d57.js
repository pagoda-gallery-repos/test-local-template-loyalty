(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[141],{8141:function(e,t,s){"use strict";s.d(t,{Z:function(){return S}});var a=s(5893),r=s(7294),n=s(5244),l=s(233);let i=()=>(0,a.jsx)(l.Z,{}),o=e=>{let{ftMetadata:t,product:s}=e;return(0,a.jsxs)("div",{className:" leading-4 mt-2 overflow-hidden text-left shadow-2xl ring-1 ring-gray-900/5 rounded-lg",children:[(0,a.jsx)("div",{className:"px-6 py-4 bg-indigo-500 text-white",children:(0,a.jsxs)("h1",{className:"text-xl",children:[(0,a.jsx)("span",{className:"text-indigo-300 font-light",children:"Loyalty Program "}),(0,a.jsx)("span",{className:"font-medium",children:"Rules"})]})}),(0,a.jsx)("hr",{}),(0,a.jsx)("div",{className:"px-6 bg-white text-sm",children:(0,a.jsxs)("ul",{className:"list-decimal list-inside my-4",children:[(0,a.jsxs)("li",{className:"text-gray-600",children:["This Loyalty Program is using ",(0,a.jsxs)("span",{className:"font-bold text-black",children:[t.token_symbol," Token"]}),"."]}),(0,a.jsxs)("li",{className:"mt-2 text-gray-600",children:["You will receive"," ",(0,a.jsxs)("span",{className:"font-bold text-black",children:[s.tokensPerUnit," ",t.token_symbol," Tokens"]})," ","after the purchase."]}),(0,a.jsxs)("li",{className:"mt-2 text-gray-600",children:[(0,a.jsxs)("span",{className:"font-bold text-black",children:[s.tokenCost," ",t.token_symbol," Tokens"," "]}),"can be exchanged for one free coffee."]})]})})]})},c=()=>(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsxs)("a",{href:"https://explorer.testnet.near.org/",target:"_blank",rel:"noreferrer",className:"text-lg font-semibold leading-6 text-indigo-600 hover:text-indigo-400",children:["Open Explorer to see list of purchases ",(0,a.jsx)("span",{"aria-hidden":"true",children:"â†’"})]})}),h=e=>{let{customerUuid:t,ftMetadata:s,customerBalance:r}=e;return(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("div",{className:"pt-2 leading-4",children:(0,a.jsx)("h1",{className:"text-4xl font-bold leading-relaxed",children:"Your account details"})}),(0,a.jsx)("hr",{}),(0,a.jsxs)("div",{className:"text-base",children:[!!r||(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"mt-6 text-gray-600",children:"Welcome to the customer app! It's your first time using this loyalty program, you don't have an account yet."}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"After the first purchase:"}),(0,a.jsxs)("p",{className:"mt-2 text-gray-600",children:["- a new account will be created for you (and you don't have to do anything)",(0,a.jsx)("br",{}),"- it will be your personal account - you hold all the keys and only you have access to it",(0,a.jsx)("br",{}),"- it will be a subaccount of the manager contract - see the contracts/manager-contract to see how this happens under the hood",(0,a.jsx)("br",{}),"- This account will be a full Near account. You can perform operations on the blockchain like getting and spending your tokens, deploying contracts and more.",(0,a.jsx)("br",{})]})]}),!!r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"mt-6 text-gray-600",children:["Your User ID for ",s.token_name," Loyalty Program:"]}),(0,a.jsx)("p",{className:"text-gray-900 text-2xl font-bold",children:t}),(0,a.jsxs)("p",{className:"mt-6 text-gray-600",children:["Your ",s.token_symbol," token balance is:"]}),(0,a.jsxs)("p",{className:"text-gray-900 text-2xl font-bold",children:[r," ",s.token_symbol]}),(0,a.jsx)(c,{})]})]})]})},d=e=>{let{purchaseWithCC:t,product:s,buyWithCCLoader:r}=e;return(0,a.jsxs)("div",{className:"hover:bg-indigo-50 h-full relative bg-white pb-8 shadow-2xl ring-1 ring-gray-900/5 sm:mx-auto sm:rounded-2xl",children:[(0,a.jsxs)("div",{className:"px-10 py-10 pb-12 flex-column",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:s.name}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Use Credit Card to buy"}),(0,a.jsxs)("p",{className:"mt-10 mb-4",children:[(0,a.jsx)("span",{className:"text-5xl font-bold",children:s.fiatCost}),(0,a.jsx)("span",{className:"text-xl text-gray-500",children:" / one"})]}),(0,a.jsxs)("button",{onClick:t,className:"w-full rounded-md bg-indigo-500 px-10 py-3 text-xl leading-10 text-white shadow-sm hover:bg-indigo-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",disabled:r,children:[r&&"Buying",r||(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-indigo-300",children:"Buy with"}),(0,a.jsx)("span",{className:"font-bold",children:" Credit Card"})]})]})]}),(0,a.jsx)("hr",{}),(0,a.jsx)("div",{className:"px-10 flex-column",children:(0,a.jsxs)("ul",{className:"list-disc pl-6 text-xs text-gray-500 mt-10",children:[(0,a.jsx)("li",{children:"This will simulate purchase via Credit Card"}),(0,a.jsx)("li",{children:"When you click this button, a request will be sent to backend.js where normally a payment via a credit card would be made."}),(0,a.jsx)("li",{children:"Upon 'successful' simulated CC payment, it's time to transfer tokens to your own personal account that is created upon your first purchase. The manager contract calls the FT contract perform the transfer."})]})})]})},u=e=>{let{canCollect:t,purchaseWithTokens:s,product:r,ftMetadata:n,buyWithTokensLoader:l}=e;return(0,a.jsx)("div",{className:" ",children:(0,a.jsxs)("div",{className:"relative overflow-hidden z-0 relative h-full relative bg-white pb-8 shadow-2xl ring-1 ring-gray-900/5 sm:mx-auto sm:rounded-2xl",children:[!t&&(0,a.jsx)("div",{className:"z-10 absolute w-full h-full bg-gray-100 opacity-50"}),(0,a.jsxs)("div",{className:"relative hover:bg-indigo-50",children:[(0,a.jsxs)("div",{className:"px-10 py-10 pb-12 flex-column",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:r.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Use ",n.token_symbol," Tokens to buy"]}),(0,a.jsxs)("p",{className:"mt-10 mb-4",children:[(0,a.jsxs)("span",{className:"text-5xl font-bold",children:[r.tokenCost," ",n.token_symbol]}),(0,a.jsx)("span",{className:"text-xl text-gray-500",children:" / one"})]}),(0,a.jsxs)("button",{onClick:s,className:"w-full rounded-md bg-indigo-500 px-10 py-3 text-xl leading-10 text-white shadow-sm hover:bg-indigo-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",disabled:l,children:[l&&"Buying",l||(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-indigo-300",children:"Buy with"}),(0,a.jsxs)("span",{className:"font-bold",children:[" ",n.token_symbol," Token"]})]})]})]}),(0,a.jsx)("hr",{}),(0,a.jsx)("div",{className:"px-10 flex-column",children:(0,a.jsxs)("ul",{className:"list-disc pl-6 text-xs text-gray-500 mt-10",children:[(0,a.jsx)("li",{children:"If you can use this option this means that an account was already created for you (this happens when you buy a coffee with CC for the first time)"}),(0,a.jsx)("li",{children:"The call is made to the FT contract to transfer tokens from your account to manager's account."}),(0,a.jsx)("li",{children:"The call is authorized with a pair of keys associated with this account. Only you have the access to your tokens."})]})})]})]})})},x=e=>{let{ftMetadata:t,product:s,customerUuid:r,customerBalance:n,purchaseWithCC:l,canCollect:i,purchaseWithTokens:c,buyWithCCLoader:x,buyWithTokensLoader:m}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-10 mt-10",children:[(0,a.jsx)(h,{customerUuid:r,ftMetadata:t,customerBalance:n}),(0,a.jsx)(o,{ftMetadata:t,product:s})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-10 mt-10",style:{height:"34rem"},children:[(0,a.jsx)(d,{purchaseWithCC:l,product:s,buyWithCCLoader:x}),(0,a.jsx)(u,{canCollect:i,purchaseWithTokens:c,product:s,ftMetadata:t,buyWithTokensLoader:m})]})]})};var m=s(4634);let g=e=>{let{programsList:t}=e;return(0,a.jsx)(m.Z,{programsList:t,details:!1})};var y=s(6262);let f=e=>{let{ftMetadata:t,programIsActive:s,merchantAddress:r}=e;return(0,a.jsxs)(y.Z,{children:[r&&"Loyalty Program",r&&(s?t.token_name:"You don't have a loyalty program yet"),s||"Choose the loyalty program from the list:"]})};var p=s(1163),j=s(9683),b=s(8905),w=s(8748),N=s(8226);let{utils:k,keyStores:v,connect:C,Contract:_}=s(8447),P=new class{async purchaseCoffeeWithCC(){let e=(0,n.hc)();await this.getKeyPair()||await this.createKeyPair();let t=await this.getKeyPair();return this.backend.createAndTransfer(t.getPublicKey().toString(),e)}async purchaseCoffeeWithTokens(){if(!await this.getKeyPair())throw Error("You need to buy coffee with CC first");let e=await this.getFtContract();return await e.ft_transfer({receiver_id:this.getManagerContractId(),amount:"30"},"3000000000000","1")}async getBalance(){if(!await this.getKeyPair())return 0;let e=await this.getFtContract();return await e.ft_balance_of({account_id:this.getAccountName()})}async getFtContract(){let e=await this.getKeyPair(),t=new v.InMemoryKeyStore;t.setKey(this.networkId,this.getAccountName(),e),this.nearConnection=await C({networkId:"testnet",keyStore:t,nodeUrl:"https://rpc.testnet.near.org",walletUrl:"https://wallet.testnet.near.org",helperUrl:"https://helper.testnet.near.org",explorerUrl:"https://explorer.testnet.near.org"});let s=await this.nearConnection.account(this.getAccountName());return new _(s,this.getFtContractId(),{viewMethods:["ft_balance_of"],changeMethods:["ft_transfer"]})}async createKeyPair(){let e=k.key_pair.KeyPairEd25519.fromRandom();await this.keyStore.setKey(this.networkId,this.getAccountName(),e)}async getKeyPair(){return await this.keyStore.getKey(this.networkId,this.getAccountName())}getAccountName(){let e=(0,n.hc)();return"".concat(e,".").concat(this.getManagerContractId())}getManagerContractId(){return(0,n.sV)()}getFtContractId(){return(0,n.FH)()}constructor(){this.networkId="testnet",this.keyStore=new v.BrowserLocalStorageKeyStore,this.backend=w.y}},T=()=>{let e=(0,p.useRouter)(),t=e.query.program,[s,l]=(0,r.useState)(!0),[o,c]=(0,r.useState)(!1),[h,d]=(0,r.useState)({}),[u,m]=(0,r.useState)(!1),[y,k]=(0,r.useState)(),[v,C]=(0,r.useState)(""),[_,T]=(0,r.useState)([]),[S,I]=(0,r.useState)(!1),[K,F]=(0,r.useState)(!1);async function W(e){F(!0),P.purchaseCoffeeWithTokens().then(()=>{alert("Coffee bought with tokens"),F(!0)}).then(()=>P.getBalance().then(e=>k(e))).catch(alert).catch(alert)}(0,r.useEffect)(()=>{let e=async()=>{await w.y.startUp();let e=!!w.y.checkIsProgramActive();l(!1),m(e)};e()},[]),(0,r.useEffect)(()=>{if(!u||!t)return;let e=async()=>{C((0,n.hc)()),await N.d.checkProgramExists(t).then(e=>{c(e)}),l(!1)};l(!0),e()},[u,t]),(0,r.useEffect)(()=>{N.d.getAllPrograms().then(e=>{T(e)})},[u]),(0,r.useEffect)(()=>{if(!o)return;let e=async()=>{let e=await N.d.getProgram(t);d(e.ft);let s=await P.getBalance();k(s),l(!1)};l(!0),e()},[u,t,o]);let U={name:"Large Coffe",fiatCost:"$9.99",tokenCost:30,tokensPerUnit:10},A=y>=U.tokenCost,L=!!h.account_id;return(0,a.jsxs)(j.Z,{variant:"customer",header:(0,a.jsx)(i,{}),children:[s&&(0,a.jsx)(b.Z,{}),s||(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f,{ftMetadata:h,programIsActive:L,merchantAddress:t}),L&&(0,a.jsx)(x,{ftMetadata:h,product:U,customerUuid:v,customerBalance:y,purchaseWithCC:function(e){I(!0),P.purchaseCoffeeWithCC().then(()=>{alert("Coffee bought with Credit Card"),I(!1)}).then(()=>P.getBalance().then(e=>k(e))).catch(alert).catch(alert)},canCollect:A,purchaseWithTokens:W,buyWithCCLoader:S,buyWithTokensLoader:K}),L||(0,a.jsx)(g,{programsList:_})]})]})};var S=T},1163:function(e,t,s){e.exports=s(880)}}]);